<!DOCTYPE html>
<html lang="az">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kredit İdarəetmə Sistemi (v4.0 - Yekun Stabil)</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />

    <style>
        :root { --primary-color: #4a90e2; --secondary-color: #f5a623; --danger-color: #d0021b; --success-color: #7ed321; --info-color: #4abde2; --dark-color: #2c3e50; --dark-color-lighter: #34495e; --light-color: #ecf0f1; --background-color: #f4f7f6; --text-color: #333; --border-color: #e0e0e0; --shadow: 0 10px 15px -3px rgba(0,0,0,0.1), 0 4px 6px -2px rgba(0,0,0,0.05); }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; }
        body { display: flex; background-color: var(--background-color); overflow-x: hidden; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes slideInFromLeft { from { transform: translateX(-100%); } to { transform: translateX(0); } }
        .sidebar { width: 280px; height: 100vh; background: linear-gradient(180deg, var(--dark-color) 0%, #1c2833 100%); color: var(--light-color); display: flex; flex-direction: column; padding: 20px 0; box-shadow: var(--shadow); position: fixed; left: 0; top: 0; transition: width 0.3s ease; animation: slideInFromLeft 0.5s ease-out; z-index: 100; }
        .sidebar-header { padding: 0 25px; margin-bottom: 30px; display: flex; align-items: center; }
        .sidebar-header .logo-icon { font-size: 28px; color: var(--primary-color); margin-right: 15px; }
        .sidebar-header h2 { font-weight: 600; font-size: 22px; color: var(--light-color); }
        .menu-list { list-style: none; flex-grow: 1; overflow-y: auto; }
        .menu-list > li > a { display: flex; align-items: center; padding: 15px 25px; color: var(--light-color); text-decoration: none; transition: all 0.3s ease; margin: 2px 15px; border-radius: 8px; font-weight: 500; cursor: pointer; }
        .menu-list > li > a:hover { background-color: var(--dark-color-lighter); }
        .menu-list .menu-icon { font-size: 18px; width: 25px; margin-right: 20px; text-align: center; }
        .arrow-icon { margin-left: auto; transition: transform 0.3s ease-in-out; }
        li.open > a .arrow-icon { transform: rotate(90deg); }
        .submenu { list-style: none; padding-left: 0; background-color: #1c2833; max-height: 0; overflow: hidden; transition: max-height 0.4s ease-in-out; }
        li.open > .submenu { max-height: 500px; }
        .submenu li a { display: flex; align-items: center; padding: 12px 20px 12px 55px; color: var(--light-color); text-decoration: none; font-size: 14px; transition: all 0.2s ease; }
        .submenu li a:hover { background-color: var(--dark-color-lighter) !important; }
        .submenu li a.active { color: var(--secondary-color); font-weight: 600; }
        .main-content { flex-grow: 1; margin-left: 280px; padding: 30px; transition: margin-left 0.3s ease; overflow-y: auto; height: 100vh; }
        .main-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; }
        .main-header h1, .main-header h2 { margin-bottom: 0; }
        .page { animation: fadeIn 0.6s ease-out; }
        @keyframes fadeInScale { from { opacity: 0; transform: scale(0.98); } to { opacity: 1; transform: scale(1); } }
        h1, h2 { color: var(--dark-color); margin-bottom: 20px; }
        h1 i, h2 i { color: var(--primary-color); }
        .collapsible-container { background-color: #fff; border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); margin-bottom: 25px; overflow: hidden; }
        .collapsible-header { padding: 15px 25px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--border-color); }
        .collapsible-header h2 { margin: 0; font-size: 1.2em; }
        .collapsible-content { padding: 25px; max-height: 500px; transition: max-height 0.4s ease-in-out, padding 0.4s ease-in-out; }
        .collapsible-container.collapsed .collapsible-content { max-height: 0; padding-top: 0; padding-bottom: 0; }
        .collapsible-header .toggle-icon { transition: transform 0.3s ease; }
        .collapsible-container.collapsed .toggle-icon { transform: rotate(-90deg); }
        .dashboard-cards { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; }
        .card { background-color: #fff; padding: 25px; border-radius: 8px; border: 1px solid #f0f0f0; display: flex; align-items: center; transition: transform 0.3s ease, box-shadow 0.3s ease; }
        .card:hover { transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0,0,0,0.08); }
        .card .icon { font-size: 2.5rem; margin-right: 20px; padding: 15px; border-radius: 50%; color: #fff; }
        .card.card-customers .icon { background-color: var(--primary-color); }
        .card.card-debt .icon { background-color: var(--danger-color); }
        .card.card-overdue .icon { background-color: var(--secondary-color); }
        .card.card-paid .icon { background-color: var(--success-color); }
        .card .info h3 { font-size: 2rem; color: var(--dark-color); }
        .card .info p { font-size: 0.9rem; color: #777; }
        form { background: #fff; padding: 25px; border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        .form-section-title { font-weight: 600; color: var(--primary-color); margin-top: 20px; margin-bottom: 15px; border-bottom: 1px solid var(--border-color); padding-bottom: 5px; }
        .form-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 15px; }
        .form-group { display: flex; flex-direction: column; }
        .input-group { display: flex; align-items: center; gap: 5px; }
        .input-group select { flex: 0 0 80px; }
        .input-group input { flex: 1; }
        .form-group label { margin-bottom: 5px; font-weight: 500; font-size: 14px; }
        .form-group .checkbox-label { flex-direction: row; align-items: center; gap: 10px; cursor: pointer; }
        .form-group input, .form-group select { width: 100%; padding: 12px; border: 1px solid var(--border-color); border-radius: 5px; font-size: 16px; transition: border-color 0.3s, box-shadow 0.3s; background-color: #fff; }
        .form-group input[type="checkbox"] { width: auto; }
        .form-group input:read-only { background-color: #f1f1f1; cursor: not-allowed; font-weight: bold; }
        .form-group input:focus, .form-group select:focus { outline: none; border-color: var(--primary-color); box-shadow: 0 0 5px rgba(74, 144, 226, 0.5); }
        #sifreler-form .form-group, #sifreler-form-edit .form-group, #magazaAdiFormu .form-group { max-width: 400px; }
        .password-feedback { font-size: 14px; margin-top: 5px; }
        .password-buttons-container { display: flex; flex-direction: column; gap: 10px; align-items: flex-start; }
        .submit-btn { background-color: var(--primary-color); color: #fff; border: none; padding: 12px 25px; font-size: 16px; font-weight: 600; border-radius: 5px; cursor: pointer; transition: background-color 0.3s, transform 0.2s; margin-top: 10px; display: inline-flex; align-items: center; gap: 8px; }
        .submit-btn:disabled { background-color: #aaa; cursor: not-allowed; }
        .submit-btn:hover:not(:disabled) { background-color: #3a7ac8; transform: translateY(-2px); }
        .export-btn { background-color: var(--success-color); }
        .export-btn:hover { background-color: #69b31c; }
        #searchBox { width: 100%; padding: 12px; margin-bottom: 20px; border: 1px solid var(--border-color); border-radius: 5px; font-size: 16px; }
        .table-container { background: #fff; border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); overflow-x: auto; margin-top: 20px; }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 15px; text-align: left; border-bottom: 1px solid var(--border-color); white-space: nowrap; }
        td .customer-code { display: block; font-size: 12px; color: #777; }
        tbody tr { transition: background-color 0.3s ease; }
        tbody tr:hover { background-color: #f8f9fa; }
        .search-results-table td:last-child { width: 1%; }
        .search-results-table .select-customer-btn { padding: 5px 10px; font-size: 12px; background-color: var(--success-color); }
        #tarixceCedveli th, #tarixceCedveli td, #fakturaTarixcesiCedveli th, #fakturaTarixcesiCedveli td { padding: 8px 10px; font-size: 13px; text-align: center; vertical-align: middle; }
        #tarixceCedveli ul { margin: 0; padding: 0 0 0 10px; list-style-type: none; text-align: left; }
        #tarixceCedveli ul li { font-size: 12px; margin-bottom: 4px; border-bottom: 1px solid #eee; padding-bottom: 4px; }
        #tarixceCedveli ul li:last-child { border-bottom: none; margin-bottom: 0; }
        #tarixceCedveli .action-btn { padding: 2px 5px; font-size: 11px; }
        thead { background-color: #f8f9fa; }
        th { font-weight: 600; color: var(--dark-color); cursor: pointer; user-select: none; }
        th .sort-icon { margin-left: 5px; opacity: 0.5; }
        th.sorted .sort-icon { opacity: 1; }
        .status-indicator { display: inline-block; width: 12px; height: 12px; border-radius: 50%; }
        .status-gecikir { background-color: var(--danger-color); }
        .status-bugun { background-color: var(--secondary-color); }
        .status-yaxinlasir { background-color: var(--success-color); }
        .status-normal { background-color: #ccc; }
        .status-nagd { background-color: var(--info-color); }
        .status-kredit { background-color: #6c757d; }
        .action-btn { padding: 6px 10px; border: none; border-radius: 5px; cursor: pointer; color: #fff; margin: 2px; font-size: 13px; transition: opacity 0.3s; }
        .action-btn:hover { opacity: 0.8; }
        .pay-btn { background-color: var(--primary-color); }
        .edit-btn { background-color: var(--secondary-color); }
        .delete-btn { background-color: var(--danger-color); }
        .details-btn { background-color: var(--info-color); }
        .view-details-btn { background-color: #6c757d; }
        .print-receipt-btn { background-color: var(--success-color); }
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.6); animation: fadeIn 0.4s ease; }
        #cekModal, #nagdCekModal { z-index: 1050; }
        #confirmModal { z-index: 1060; }
        #passwordChangeModal { z-index: 1070; }
        .modal-content { background-color: #fefefe; margin: 5% auto; padding: 30px; border-radius: 8px; width: 90%; max-width: 700px; position: relative; box-shadow: 0 5px 25px rgba(0,0,0,0.2); animation: slideInDown 0.5s ease-out; }
        .modal-content.modal-sm { max-width: 500px; }
        .modal-content.modal-lg { max-width: 800px; }
        .modal-content.modal-confirm { max-width: 400px; text-align: center; }
        @keyframes slideInDown { from { transform: translateY(-30px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .close-btn { color: #aaa; position: absolute; top: 15px; right: 20px; font-size: 28px; font-weight: bold; cursor: pointer; transition: color 0.3s, transform 0.3s; }
        .close-btn:hover, .close-btn:focus { color: black; transform: rotate(90deg); }
        .details-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px 25px; }
        .details-item { padding: 8px 0; border-bottom: 1px solid #eee; }
        .details-item strong { color: #555; display: block; font-size: 13px; margin-bottom: 2px; }
        .details-item span { font-size: 16px; color: #333; }
        .selected-customer-info { background-color: #e9f3fe; border: 1px solid var(--primary-color); padding: 15px; border-radius: 5px; margin-top: 10px; margin-bottom: 15px; }
        .selected-customer-info p { margin: 0; }
        .selected-customer-info button { margin-left: 15px; padding: 2px 8px; font-size: 12px; background-color: var(--danger-color); }
        .printable-content { border: 1px dashed #333; padding: 20px; margin-bottom: 20px; }
        .printable-content h2 { text-align: center; margin-bottom: 15px; }
        .printable-content p { margin-bottom: 10px; font-size: 16px; }
        .printable-content hr { margin: 15px 0; }
        #muqavileBody h3 { margin-top: 20px; border-bottom: 1px solid #ccc; padding-bottom: 5px; }
        #muqavileBody .muqavile-row { display: flex; justify-content: space-between; margin-bottom: 8px; }
        #muqavileBody .muqavile-row strong { color: #555; }
        #qrafikCedveli { width: 100%; margin-top: 15px; border-collapse: collapse; }
        #qrafikCedveli th, #qrafikCedveli td { border: 1px solid #ccc; padding: 8px; text-align: center; }
        #qrafikCedveli thead { background-color: #f2f2f2; }
        .modal-actions { text-align: right; margin-top: 20px; }
        .modal-actions .submit-btn { margin-left: 10px; }
        #confirmModal .modal-content { padding-top: 40px; }
        #confirmModal .confirm-icon { width: 80px; height: 80px; border-radius: 50%; background-color: var(--secondary-color); color: white; font-size: 40px; display: flex; align-items: center; justify-content: center; margin: -70px auto 20px; box-shadow: 0 4px 10px rgba(245, 166, 35, 0.4); }
        #confirmModal h3 { font-size: 22px; margin-bottom: 10px; }
        #confirmModal p { margin-bottom: 25px; font-size: 16px; color: #666; }
        #confirmModal .modal-actions { justify-content: center; display: flex; gap: 15px; }
        #confirmModal .confirm-btn-yes { background-color: var(--success-color); }
        #confirmModal .confirm-btn-no { background-color: var(--danger-color); }
        .paid-row { background-color: #e8f5e9; }
        .partially-paid-row { background-color: #fffde7; }
        @media print { body * { visibility: hidden; } .sidebar, .modal-actions, .close-btn { display: none; } .printable-modal, .printable-modal *, .printable-content, .printable-content * { visibility: visible; } .printable-modal { position: absolute; left: 0; top: 0; width: 100%; height: 100%; margin: 0; padding: 0; background: none; overflow: visible !important; } .main-content { margin: 0 !important; padding: 0 !important; } .modal-content { box-shadow: none; border: none; margin: 0; max-width: 100%; padding: 5px; } #muqavileBody, #muqavileBody p { font-size: 10pt; line-height: 1.4; } #muqavileBody h2 { font-size: 14pt; } #muqavileBody h3 { font-size: 11pt; margin-top: 10px; } #qrafikCedveli th, #qrafikCedveli td { padding: 4px; font-size: 9pt; } }
    </style>
</head>
<body>
    <nav class="sidebar"> 
        <div class="sidebar-header">
            <i class="fas fa-cubes logo-icon"></i>
            <h2>Kredit Sistemi</h2>
        </div>
        <ul class="menu-list">
             <li>
                <a class="submenu-item" data-content="idarə-paneli-sehifesi">
                    <i class="fas fa-home menu-icon"></i><span class="menu-text">Əsas Səhifə</span>
                </a>
            </li>
            <li>
                <a>
                    <i class="fas fa-shopping-cart menu-icon"></i>
                    <span class="menu-text">Satış</span>
                    <i class="fas fa-chevron-right arrow-icon"></i>
                </a>
                <ul class="submenu">
                    <li><a href="#" class="submenu-item" data-content="yeni-kredit-sehifesi"><i class="fas fa-plus-circle menu-icon"></i> Yeni Kredit</a></li>
                    <li><a href="#" class="submenu-item" data-content="nagd-satis-sehifesi"><i class="fas fa-dollar-sign menu-icon"></i> Nağd Satış</a></li>
                </ul>
            </li>
            <li>
                <a>
                    <i class="fas fa-money-check-alt menu-icon"></i>
                    <span class="menu-text">Ödəniş</span>
                    <i class="fas fa-chevron-right arrow-icon"></i>
                </a>
                <ul class="submenu">
                    <li><a href="#" class="submenu-item" data-content="kassa-medaxil-sehifesi"><i class="fas fa-cash-register menu-icon"></i> Kassa mədaxil</a></li>
                    <li><a href="#" class="submenu-item" data-content="kassa-gun-sonu-sehifesi"><i class="fas fa-chart-line menu-icon"></i> Kassa Gün sonu</a></li>
                </ul>
            </li>
            <li>
                <a>
                    <i class="fas fa-users menu-icon"></i>
                    <span class="menu-text">Müştəri</span>
                    <i class="fas fa-chevron-right arrow-icon"></i>
                </a>
                <ul class="submenu">
                    <li><a href="#" class="submenu-item" data-content="musteri-bazasi-sehifesi"><i class="fas fa-database menu-icon"></i> Müştəri Bazası</a></li>
                </ul>
            </li>
            <li>
                <a>
                    <i class="fas fa-chart-pie menu-icon"></i>
                    <span class="menu-text">Hesabat</span>
                    <i class="fas fa-chevron-right arrow-icon"></i>
                </a>
                <ul class="submenu">
                    <li><a href="#" class="submenu-item" data-content="satis-hesabati-sehifesi"><i class="fas fa-file-invoice-dollar menu-icon"></i> Satış Hesabatı</a></li>
                    <li><a href="#" class="submenu-item" data-content="kassa-hesabati-sehifesi"><i class="fas fa-cash-register menu-icon"></i> Kassa Hesabatı</a></li>
                    <li><a href="#" class="submenu-item" data-content="bank-odenisleri-sehifesi"><i class="fas fa-university menu-icon"></i> Bank Ödənişləri</a></li>
                </ul>
            </li>
            <li>
                <a>
                    <i class="fas fa-cog menu-icon"></i>
                    <span class="menu-text">Tənzimləmələr</span>
                    <i class="fas fa-chevron-right arrow-icon"></i>
                </a>
                <ul class="submenu">
                    <li><a href="#" class="submenu-item" data-content="sifreler-sehifesi"><i class="fas fa-key menu-icon"></i> Şifrələr</a></li>
                    <li><a href="#" class="submenu-item" data-content="magaza-adi-sehifesi"><i class="fas fa-store menu-icon"></i> Mağaza Adı</a></li>
                </ul>
            </li>
        </ul>
    </nav>

    <main class="main-content">
        <div id="content-area">
            </div>
    </main>
    
    <div id="passwordChangeModal" class="modal">...</div>
    <div id="detailsModal" class="modal">...</div>
    <div id="odenisModal" class="modal">...</div>
    <div id="cekModal" class="modal printable-modal">...</div>
    <div id="nagdCekModal" class="modal printable-modal">...</div>
    <div id="editModal" class="modal">...</div>
    <div id="muqavileModal" class="modal printable-modal">...</div>
    <div id="odenisTarixcesiModal" class="modal printable-modal">...</div>
    <div id="confirmModal" class="modal">...</div>


    <script>
    document.addEventListener('DOMContentLoaded', async () => {
        
        const mainMenuItems = document.querySelectorAll('.menu-list > li > a:not(.submenu-item)');
        const submenuItems = document.querySelectorAll('.submenu-item');
        const contentArea = document.getElementById('content-area');

        mainMenuItems.forEach(item => {
            item.addEventListener('click', function(event) {
                event.preventDefault();
                const parentLi = this.parentElement;
                if (parentLi.querySelector('.submenu')) {
                    document.querySelectorAll('.menu-list > li').forEach(li => {
                        if (li !== parentLi && li.classList.contains('open')) {
                            li.classList.remove('open');
                        }
                    });
                    parentLi.classList.toggle('open');
                }
            });
        });

        submenuItems.forEach(item => {
            item.addEventListener('click', function(event) {
                event.preventDefault();
                submenuItems.forEach(link => link.classList.remove('active'));
                this.classList.add('active');
                document.querySelectorAll('.menu-list > li.active').forEach(li => li.classList.remove('active'));
                if (this.closest('.submenu')) {
                    this.closest('li.open').classList.add('active');
                } else {
                    this.parentElement.classList.add('active');
                }
                const contentId = this.dataset.content;
                updateContent(contentId);
            });
        });

        const contentMap = {
            'idarə-paneli-sehifesi': { render: function(c){c.innerHTML = `<section id="idarə-paneli-sehifesi" class="page"><div class="main-header"><h1><i class="fas fa-home"></i> Əsas Səhifə</h1></div><div id="dashboard-collapsible" class="collapsible-container"><div class="collapsible-header"><h2><i class="fas fa-database"></i> Ümumi baza məlumatı</h2><i class="fas fa-chevron-down toggle-icon"></i></div><div class="collapsible-content"><div class="dashboard-cards"><div class="card card-customers"><div class="icon"><i class="fas fa-users"></i></div><div class="info"><h3 id="total-customers">0</h3><p>Aktiv Müştəri</p></div></div><div class="card card-debt"><div class="icon"><i class="fas fa-wallet"></i></div><div class="info"><h3 id="total-debt">0 AZN</h3><p>Ümumi Qalıq Borc</p></div></div><div class="card card-overdue"><div class="icon"><i class="fas fa-exclamation-triangle"></i></div><div class="info"><h3 id="overdue-payments">0</h3><p>Gecikmədə olan</p></div></div><div class="card card-paid"><div class="icon"><i class="fas fa-check-circle"></i></div><div class="info"><h3 id="paid-this-month">0 AZN</h3><p>Bu Ay Ödənilib</p></div></div></div></div></div></section>`;},
                init: function(){ const d = document.getElementById('dashboard-collapsible'); if(d) d.querySelector('.collapsible-header').addEventListener('click', () => d.classList.toggle('collapsed')); updateDashboard(); }
            },
            'yeni-kredit-sehifesi': { render: function(c){c.innerHTML = `<section id="yeni-kredit-sehifesi" class="page"><div class="main-header"><h1><i class="fas fa-file-invoice-dollar"></i> Yeni Kredit Müraciəti</h1></div><form id="kreditFormu"><input type="hidden" id="kreditMusteriId"><h3 class="form-section-title">Müştəri Seçimi</h3><div class="form-group"><label class="checkbox-label"><input type="checkbox" id="yeniKreditMusteriCheckbox" checked><span>Yeni müştəridir?</span></label></div><div id="movcudKreditMusteriFormu" style="display: none;"><div id="selectedKreditCustomerInfo" class="selected-customer-info" style="display:none;"></div><div id="kreditCustomerSearchArea"><div class="form-row" style="align-items: flex-end;"><div class="form-group" style="flex-grow: 1;"><label for="kreditMusteriAxtarInput"><i class="fas fa-search"></i> Müştərini axtar (Ad, Kod, FİN, Telefon)</label><input type="text" id="kreditMusteriAxtarInput" placeholder="Axtarış üçün məlumat daxil edin..."></div><div class="form-group"><button type="button" id="kreditMusteriAxtarBtn" class="submit-btn" style="margin-top: 0;"><i class="fas fa-search"></i> Axtar</button></div></div><div id="kreditMusteriAxtarNeticeleri" class="table-container" style="display: none;"><table class="search-results-table"><thead><tr><th>Müştəri</th><th>FİN Kod</th><th>Telefonlar</th><th>Seç</th></tr></thead><tbody id="kreditMusteriAxtarCedveli"></tbody></table></div></div></div><div id="yeniKreditMusteriFormu"><h3 class="form-section-title">Müştəri Məlumatları</h3><div class="form-row"><div class="form-group"><label for="ad"><i class="fas fa-user"></i> Ad</label><input type="text" id="ad" required></div><div class="form-group"><label for="soyad"><i class="fas fa-user"></i> Soyad</label><input type="text" id="soyad" required></div><div class="form-group"><label for="ataAdi"><i class="fas fa-user"></i> Ata adı</label><input type="text" id="ataAdi" required></div></div><div class="form-row"><div class="form-group"><label for="cins"><i class="fas fa-venus-mars"></i> Cins</label><select id="cins" required><option value="Kişi">Kişi</option><option value="Qadın">Qadın</option></select></div><div class="form-group"><label for="finKod"><i class="fas fa-id-card"></i> FİN Kod</label><input type="text" id="finKod" required minlength="7" maxlength="7"></div><div class="form-group"><label for="vesiqeSeria">Vəsiqə Seriya və Nömrəsi</label><div class="input-group"><select id="vesiqeSeria"><option value="AZE">AZE</option><option value="AA">AA</option></select><input type="text" id="vesiqeNomre" class="numeric-input" required pattern="\\d{7}" maxlength="7" placeholder="1234567"></div></div></div><div class="form-row"><div class="form-group"><label for="mobil1-nomre"><i class="fas fa-mobile-alt"></i> Əsas Mobil Nömrə</label><div class="input-group"><select id="mobil1-prefix"><option>050</option><option>051</option><option>055</option><option>010</option><option>070</option><option>077</option><option>099</option></select><input type="tel" id="mobil1-nomre" class="numeric-input" required pattern="\\d{7}" maxlength="7" placeholder="1234567"></div></div><div class="form-group"><label for="mobil2-nomre"><i class="fas fa-phone"></i> Əlavə Nömrə 1</label><div class="input-group"><select id="mobil2-prefix"><option>050</option><option>051</option><option>055</option><option>010</option><option>070</option><option>077</option><option>099</option></select><input type="tel" id="mobil2-nomre" class="numeric-input" pattern="\\d{7}" maxlength="7" placeholder="1234567"></div></div><div class="form-group"><label for="mobil3-nomre"><i class="fas fa-phone"></i> Əlavə Nömrə 2</label><div class="input-group"><select id="mobil3-prefix"><option>050</option><option>051</option><option>055</option><option>010</option><option>070</option><option>077</option><option>099</option></select><input type="tel" id="mobil3-nomre" class="numeric-input" pattern="\\d{7}" maxlength="7" placeholder="1234567"></div></div></div></div><h3 class="form-section-title">Kredit Məlumatları</h3><div class="form-row"><div class="form-group"><label for="mehsulAdi"><i class="fas fa-box"></i> Məhsulun Adı</label><input type="text" id="mehsulAdi" required></div><div class="form-group"><label for="mehsulKateqoriya"><i class="fas fa-tags"></i> Kateqoriya</label><select id="mehsulKateqoriya" required><option value="" disabled selected>Kateqoriya seçin</option><option value="Mobil telefon">Mobil telefon</option><option value="Böyük məişət texnikası">Böyük məişət texnikası</option><option value="Kiçik məişət texnikası">Kiçik məişət texnikası</option><option value="Aksesuar">Aksesuar</option><option value="Digər">Digər</option></select></div></div><div class="form-row"><div class="form-group"><label for="nagdQiymet"><i class="fas fa-money-bill-wave"></i> Nağd Qiyməti (AZN)</label><input type="number" id="nagdQiymet" required min="0"></div><div class="form-group"><label for="kreditMuddeti"><i class="fas fa-calendar-alt"></i> Kredit Müddəti (Ay)</label><select id="kreditMuddeti"><option value="3">3 Ay (+8%)</option><option value="6">6 Ay (+8%)</option><option value="9">9 Ay (+8%)</option><option value="12" selected>12 Ay (+15%)</option><option value="18">18 Ay (+20%)</option></select></div><div class="form-group"><label for="ilkinOdenis"><i class="fas fa-hand-holding-usd"></i> İlkin Ödəniş (AZN)</label><input type="number" id="ilkinOdenis" value="0" min="0"></div></div><div class="form-row" style="background: #f8f9fa; padding: 15px; border-radius: 5px; align-items: center;"><div class="form-group"><label for="kreditQiymeti"><i class="fas fa-credit-card"></i> Ümumi Kredit Məbləği (AZN)</label><input type="text" id="kreditQiymeti" readonly></div><div class="form-group"><label for="ayliqOdenis"><i class="fas fa-calendar-check"></i> Aylıq Ödəniş (AZN)</label><input type="text" id="ayliqOdenis" readonly></div></div><button type="submit" class="submit-btn"><i class="fas fa-file-signature"></i> Müqaviləyə Bax</button></form></section>`;},
                init: function(){ document.getElementById('kreditFormu').addEventListener('submit', handleKreditFormSubmit); ['nagdQiymet', 'kreditMuddeti', 'ilkinOdenis'].forEach(id => document.getElementById(id).addEventListener('input', calculateKreditDetails)); document.getElementById('yeniKreditMusteriCheckbox').addEventListener('change', (e) => { const isChecked = e.target.checked; document.getElementById('yeniKreditMusteriFormu').style.display = isChecked ? 'block' : 'none'; document.getElementById('movcudKreditMusteriFormu').style.display = isChecked ? 'none' : 'block'; toggleKreditFormRequired(!isChecked); if (!isChecked) { resetKreditFormCustomer(false); } }); document.getElementById('kreditMusteriAxtarBtn').addEventListener('click', handleKreditMusteriSearch); document.getElementById('kreditMusteriAxtarCedveli').addEventListener('click', handleSelectKreditMusteri); document.querySelectorAll('.numeric-input').forEach(input => input.addEventListener('input', function(e) { this.value = this.value.replace(/[^0-9]/g, ''); })); calculateKreditDetails(); toggleKreditFormRequired(false); }
            },
            'nagd-satis-sehifesi': { render: function(c){c.innerHTML = `<section id="nagd-satis-sehifesi" class="page"><div class="main-header"><h1><i class="fas fa-dollar-sign"></i> Nağd Satış</h1></div><form id="nagdFormu"><input type="hidden" id="nagdMusteriId"><h3 class="form-section-title">Məhsul Məlumatları</h3><div class="form-row"><div class="form-group"><label for="nagdMehsulAdi"><i class="fas fa-box"></i> Məhsulun Adı</label><input type="text" id="nagdMehsulAdi" required></div><div class="form-group"><label for="nagdMehsulQiymeti"><i class="fas fa-money-bill-wave"></i> Satış Qiyməti (AZN)</label><input type="number" id="nagdMehsulQiymeti" required min="0"></div></div><h3 class="form-section-title">Müştəri Məlumatları</h3><div class="form-group"><label class="checkbox-label"><input type="checkbox" id="yeniMusteriCheckbox"><span>Yeni müştəri kimi qeyd et</span></label></div><div id="yeniMusteriFormu" style="display: none;"><div class="form-row"><div class="form-group"><label for="nagdAd"><i class="fas fa-user"></i> Ad</label><input type="text" id="nagdAd"></div><div class="form-group"><label for="nagdSoyad"><i class="fas fa-user"></i> Soyad</label><input type="text" id="nagdSoyad"></div><div class="form-group"><label for="nagdAtaAdi"><i class="fas fa-user"></i> Ata adı</label><input type="text" id="nagdAtaAdi"></div></div><div class="form-row"><div class="form-group"><label for="nagdCins"><i class="fas fa-venus-mars"></i> Cins</label><select id="nagdCins"><option value="Kişi">Kişi</option><option value="Qadın">Qadın</option></select></div><div class="form-group"><label for="nagdFinKod"><i class="fas fa-id-card"></i> FİN Kod</label><input type="text" id="nagdFinKod" minlength="7" maxlength="7"></div><div class="form-group"><label for="nagdMobilNomre"><i class="fas fa-mobile-alt"></i> Mobil Nömrə</label><div class="input-group"><select id="nagdMobilPrefix"><option>050</option><option>051</option><option>055</option><option>010</option><option>070</option><option>077</option><option>099</option></select><input type="tel" id="nagdMobilNomre" class="numeric-input" pattern="\\d{7}" maxlength="7"></div></div></div></div><div id="movcudMusteriFormu"><div id="selectedCustomerInfo" class="selected-customer-info" style="display:none;"></div><div id="customerSearchArea"><div class="form-row" style="align-items: flex-end;"><div class="form-group" style="flex-grow: 1;"><label for="nagdMusteriAxtarInput"><i class="fas fa-search"></i> Müştərini axtar (Ad, Kod, FİN, Telefon)</label><input type="text" id="nagdMusteriAxtarInput" placeholder="Axtarış üçün məlumat daxil edin..."></div><div class="form-group"><button type="button" id="nagdMusteriAxtarBtn" class="submit-btn" style="margin-top: 0;"><i class="fas fa-search"></i> Axtar</button></div></div><div id="nagdMusteriAxtarNeticeleri" class="table-container" style="display: none;"><table class="search-results-table"><thead><tr><th>Müştəri</th><th>FİN Kod</th><th>Telefonlar</th><th>Seç</th></tr></thead><tbody id="nagdMusteriAxtarCedveli"></tbody></table></div></div></div><h3 class="form-section-title">Ödəniş Məlumatları</h3><div class="form-row"><div class="form-group"><label for="nagdOdenisUsulu"><i class="fas fa-credit-card"></i> Ödəniş Üsulu</label><select id="nagdOdenisUsulu"><option value="Nağd">Nağd</option><option value="Kart ilə">Kart ilə</option><option value="Kart/Nağd">Kart/Nağd</option></select></div></div><div id="nagdMixedPaymentDiv" style="display: none;"><div class="form-row"><div class="form-group"><label for="nagdKartMebleg">Kart ilə (AZN)</label><input type="number" id="nagdKartMebleg" step="0.01" min="0" value="0"></div><div class="form-group"><label for="nagdNagdMebleg">Nağd (AZN)</label><input type="number" id="nagdNagdMebleg" step="0.01" min="0" value="0"></div></div></div><button type="submit" class="submit-btn"><i class="fas fa-check-circle"></i> Satışı Tamamla</button></form></section>`;},
                init: function(){ document.getElementById('nagdFormu').addEventListener('submit', handleNagdSubmit); const y = document.getElementById('yeniMusteriCheckbox'); y.addEventListener('change', (e) => { const i = e.target.checked; document.getElementById('yeniMusteriFormu').style.display = i ? 'block' : 'none'; document.getElementById('movcudMusteriFormu').style.display = i ? 'none' : 'block'; resetNagdFormCustomer(); }); document.getElementById('nagdMusteriAxtarBtn').addEventListener('click', handleNagdMusteriSearch); document.getElementById('nagdMusteriAxtarCedveli').addEventListener('click', handleSelectNagdMusteri); const n = document.getElementById('nagdOdenisUsulu'); n.addEventListener('change', () => { if (n.value === 'Kart/Nağd') { document.getElementById('nagdMixedPaymentDiv').style.display = 'block'; document.getElementById('nagdMehsulQiymeti').readOnly = true; } else { document.getElementById('nagdMixedPaymentDiv').style.display = 'none'; document.getElementById('nagdMehsulQiymeti').readOnly = false; } }); ['nagdKartMebleg', 'nagdNagdMebleg'].forEach(id => { document.getElementById(id).addEventListener('input', () => { if (document.getElementById('nagdOdenisUsulu').value === 'Kart/Nağd') { const k = parseFloat(document.getElementById('nagdKartMebleg').value) || 0; const g = parseFloat(document.getElementById('nagdNagdMebleg').value) || 0; document.getElementById('nagdMehsulQiymeti').value = (k + g).toFixed(2); } }); }); document.querySelectorAll('.numeric-input').forEach(input => input.addEventListener('input', function(e) { this.value = this.value.replace(/[^0-9]/g, ''); })); y.checked = false; y.dispatchEvent(new Event('change')); }
            },
            'kassa-medaxil-sehifesi': { render: function(c){c.innerHTML = `<section id="kassa-medaxil-sehifesi" class="page"><div class="main-header"><h1><i class="fas fa-cash-register"></i> Kassa mədaxil</h1></div><form id="kassaAxtarFormu"><div class="form-row"><div class="form-group"><label for="kassaAxtarAd"><i class="fas fa-user"></i> Müştəri (Ad, Kod)</label><input type="text" id="kassaAxtarAd" placeholder="Ad və ya müştəri kodu daxil edin..."></div><div class="form-group"><label for="kassaAxtarFin"><i class="fas fa-id-card"></i> FİN Kod</label><input type="text" id="kassaAxtarFin" placeholder="FİN kodu daxil edin..."></div><div class="form-group"><label for="kassaAxtarTel"><i class="fas fa-phone"></i> Telefon Nömrəsi</label><input type="text" id="kassaAxtarTel" placeholder="Nömrəni daxil edin..."></div></div><button type="submit" class="submit-btn"><i class="fas fa-search"></i><span>Axtar</span></button></form><div id="kassaAxtarNeticeleri" class="table-container search-results-table" style="display: none;"><table><thead><tr><th>Müştəri</th><th>Məhsul (Faktura)</th><th>Qalıq Borc</th><th>Növbəti Ödəniş</th><th>Əməliyyat</th></tr></thead><tbody id="kassaAxtarCedveli"></tbody></table></div></section>`;},
                init: function(){ document.getElementById('kassaAxtarFormu').addEventListener('submit', handleKassaSearch); document.getElementById('kassaAxtarCedveli').addEventListener('click', handleTableActions); }
            },
            'kassa-gun-sonu-sehifesi': { render: function(c){c.innerHTML = `<section id="kassa-gun-sonu-sehifesi" class="page"><div class="main-header"><h1><i class="fas fa-chart-line"></i> Kassa Gün Sonu Hesabatı</h1></div><div class="dashboard-cards" style="margin-bottom: 25px;"><div class="card card-paid"><div class="icon"><i class="fas fa-money-bill-wave"></i></div><div class="info"><h3 id="gunSonuNagdCemi">0.00 AZN</h3><p>Nağd Mədaxil</p></div></div><div class="card card-customers"><div class="icon"><i class="far fa-credit-card"></i></div><div class="info"><h3 id="gunSonuKartCemi">0.00 AZN</h3><p>Kart Mədaxil</p></div></div><div class="card card-debt"><div class="icon"><i class="fas fa-wallet"></i></div><div class="info"><h3 id="gunSonuUmumiCemi">0.00 AZN</h3><p>Ümumi Mədaxil</p></div></div></div></section>`;},
                init: function(){ renderCurrentDayReport(); }
            },
            'musteri-bazasi-sehifesi': { render: function(c){c.innerHTML = `<section id="musteri-bazasi-sehifesi" class="page"><div class="main-header"><h1><i class="fas fa-database"></i> Müştəri Bazası</h1></div><input type="text" id="searchBox" placeholder="Ada, soyada, koda və ya FİN-ə görə axtar..."><div class="table-container"><table><thead><tr><th data-sort="status">Status</th><th data-sort="ad">Müştəri <i class="fas fa-sort sort-icon"></i></th><th data-sort="ayliqOdenis">Növbəti Ödəniş <i class="fas fa-sort sort-icon"></i></th><th data-sort="qaliqBorc">Ümumi Qalıq Borc <i class="fas fa-sort sort-icon"></i></th><th data-sort="novbetiOdenisTarixi">Ən Yaxın Ödəniş Tarixi <i class="fas fa-sort sort-icon"></i></th><th>Əməliyyatlar</th></tr></thead><tbody id="musteriCedveli"></tbody></table></div></section>`;},
                init: function(){ document.getElementById('searchBox').addEventListener('keyup', () => renderMusteriler()); document.getElementById('musteriCedveli').addEventListener('click', handleTableActions); document.querySelectorAll('#musteri-bazasi-sehifesi thead th').forEach(th => { if(th.dataset.sort) th.addEventListener('click', handleSort) }); renderMusteriler(); }
            },
            'satis-hesabati-sehifesi': { render: function(c){c.innerHTML = `<section class="page"><div class="main-header"><h1><i class="fas fa-file-invoice-dollar"></i> Satış Hesabatı</h1></div><form id="satisHesabatiFormu"><div class="form-row"><div class="form-group"><label for="satisHesabatiBaslamaTarixi">Başlama Tarixi</label><input type="date" id="satisHesabatiBaslamaTarixi" required></div><div class="form-group"><label for="satisHesabatiBitmeTarixi">Bitmə Tarixi</label><input type="date" id="satisHesabatiBitmeTarixi" required></div></div><button type="submit" class="submit-btn"><i class="fas fa-filter"></i> Filterlə</button></form><div class="table-container" style="margin-top: 20px;"><table><thead><tr><th>Faktura ID</th><th>Tarix</th><th>Müştəri Adı</th><th>Məbləğ (AZN)</th><th>Ödəniş Üsulu</th></tr></thead><tbody id="satisHesabatiCedveli"></tbody></table></div></section>`;},
                init: function(){ document.getElementById('satisHesabatiFormu').addEventListener('submit', handleSatisHesabatiFilter); setDefaultDatesAndFilter('satisHesabatiBaslamaTarixi', 'satisHesabatiBitmeTarixi', handleSatisHesabatiFilter); }
            },
            'kassa-hesabati-sehifesi': { render: function(c){c.innerHTML = `<section class="page"><div class="main-header"><h1><i class="fas fa-cash-register"></i> Kassa Hesabatı</h1></div><form id="kassaHesabatiFormu"><div class="form-row"><div class="form-group"><label for="kassaHesabatiBaslamaTarixi">Başlama Tarixi</label><input type="date" id="kassaHesabatiBaslamaTarixi" required></div><div class="form-group"><label for="kassaHesabatiBitmeTarixi">Bitmə Tarixi</label><input type="date" id="kassaHesabatiBitmeTarixi" required></div><div class="form-group"><label for="kassaHesabatiOdenisUsulu">Ödəniş Üsulu</label><select id="kassaHesabatiOdenisUsulu"><option value="Hamisi">Hamısı</option><option value="Nağd">Nağd</option><option value="Kart">Kart</option><option value="Kart/Nağd">Kart/Nağd</option></select></div></div><button type="submit" class="submit-btn"><i class="fas fa-filter"></i> Filterlə</button></form><div class="table-container" style="margin-top: 20px;"><table><thead><tr><th>Ödəniş ID</th><th>Tarix</th><th>Müştəri Adı</th><th>Məhsul (Faktura)</th><th>Məbləğ (AZN)</th><th>Ödəniş Üsulu</th></tr></thead><tbody id="kassaHesabatiCedveli"></tbody></table></div></section>`;},
                init: function(){ document.getElementById('kassaHesabatiFormu').addEventListener('submit', handleKassaHesabatiFilter); setDefaultDatesAndFilter('kassaHesabatiBaslamaTarixi', 'kassaHesabatiBitmeTarixi', handleKassaHesabatiFilter); }
            },
            'bank-odenisleri-sehifesi': { render: function(c){c.innerHTML = `<section class="page"><div class="main-header"><h1><i class="fas fa-university"></i> Bank Ödənişləri</h1></div><form id="bankOdenisleriFormu"><div class="form-row"><div class="form-group"><label for="bankOdenisleriTarix">Tarix seçin</label><input type="date" id="bankOdenisleriTarix" required></div></div><button type="submit" class="submit-btn"><i class="fas fa-eye"></i> Göstər</button></form><div class="dashboard-cards" style="margin-top: 25px;"><div class="card card-customers"><div class="icon"><i class="far fa-credit-card"></i></div><div class="info"><h3 id="bankOdenisleriCemi">0.00 AZN</h3><p>Seçilmiş Gün üzrə Kart Mədaxili</p></div></div></div></section>`;},
                init: function(){ document.getElementById('bankOdenisleriFormu').addEventListener('submit', handleBankOdenisleriFilter); const t = new Date().toISOString().split('T')[0]; document.getElementById('bankOdenisleriTarix').value = t; handleBankOdenisleriFilter(); }
            },
            'sifreler-sehifesi': { render: function(c){c.innerHTML = `<section class="page"><div class="main-header"><h1><i class="fas fa-key"></i> Şifrələrin İdarə Olunması</h1></div><div class="password-buttons-container"><button id="showDeletePassFormBtn" class="submit-btn"><i class="fas fa-trash-alt"></i> Silmə Şifrəsini Dəyiş</button><button id="showEditPassFormBtn" class="submit-btn" style="background-color: var(--secondary-color);"><i class="fas fa-edit"></i> Düzəliş Şifrəsini Dəyiş</button></div></section>`;},
                init: function(){ document.getElementById('showDeletePassFormBtn').addEventListener('click', () => { document.getElementById('passwordModalTitle').textContent = "Silmə Şifrəsini Dəyiş"; document.getElementById('deletePassFormContainer').style.display = 'block'; document.getElementById('editPassFormContainer').style.display = 'none'; document.getElementById('passwordChangeModal').style.display = 'block'; }); document.getElementById('showEditPassFormBtn').addEventListener('click', () => { document.getElementById('passwordModalTitle').textContent = "Düzəliş Şifrəsini Dəyiş"; document.getElementById('deletePassFormContainer').style.display = 'none'; document.getElementById('editPassFormContainer').style.display = 'block'; document.getElementById('passwordChangeModal').style.display = 'block'; }); }
            },
            'magaza-adi-sehifesi': { render: function(c){c.innerHTML = `<section class="page"><div class="main-header"><h1><i class="fas fa-store"></i> Mağaza Adının Tənzimlənməsi</h1></div><form id="magazaAdiFormu"><h3 class="form-section-title">Mağaza Məlumatları</h3><div class="form-group"><label for="magazaAdiInput"><i class="fas fa-signature"></i> Mağaza Adı</label><input type="text" id="magazaAdiInput" placeholder="Məsələn: Texno Ev" required></div><button type="submit" class="submit-btn"><i class="fas fa-save"></i> Yadda Saxla</button></form></section>`;},
                init: function(){ document.getElementById('magazaAdiInput').value = magazaAdi; document.getElementById('magazaAdiFormu').addEventListener('submit', async (e) => { e.preventDefault(); const newName = document.getElementById('magazaAdiInput').value.trim(); if (newName) { await api_updateSetting('magazaAdi', newName); magazaAdi = newName; alert('Mağaza adı uğurla yadda saxlanıldı!'); } else { alert('Mağaza adı boş ola bilməz.'); } }); }
            }
        };

        function updateContent(contentId) {
            const contentData = contentMap[contentId] || { render: c => c.innerHTML = `<h1>Səhifə tapılmadı</h1>`, init: () => {} };
            contentData.render(contentArea);
            if (contentData.init) contentData.init();
        }

        const GAS_URL = 'https://script.google.com/macros/s/AKfycbzsdhMN9SZvx4uxFKJ1-R11TVCVDjE5MXSGV_EXi_cl8RCtpbhfwFZU_yv0S17ua3GUCw/exec';

        let musteriler = [];
        let magazaAdi = 'Mağaza Adı';
        let passwords = { delete: "1234", edit: "1234" };
        let muveqqetiData = null;
        let sortState = { column: 'ad', direction: 'asc' };
        let currentConfirmCallback = null;
        const interestRates = { 3: 0.08, 6: 0.08, 9: 0.08, 12: 0.15, 18: 0.20 };

        async function api_call(action, data = {}) {
            try {
                const response = await fetch(GAS_URL, { method: 'POST', redirect: "follow", headers: { 'Content-Type': 'text/plain;charset=utf-8' }, body: JSON.stringify({ action, ...data }) });
                const result = await response.json();
                if (result.status !== 'success') throw new Error(result.message || 'Naməlum xəta');
                return result.data;
            } catch (error) {
                console.error(`API sorğusu zamanı xəta (${action}):`, error);
                alert(`Əməliyyat zamanı xəta baş verdi: ${error.message}\nİnternet bağlantınızı yoxlayın.`);
                return null;
            }
        }

        async function api_updateSetting(key, value) { return await api_call('updateSetting', { key, value }); }
        async function api_updatePassword(passType, currentPass, newPass) { return await api_call('updatePassword', { passType, currentPass, newPass });}

        function getFullName(musteri) { if (!musteri) return ''; return `${musteri.ad || ''} ${musteri.soyad || ''} ${musteri.ataAdi || ''}`.trim(); }
        function generateCustomerCode() { return 'M' + String(Date.now()).slice(-5); }

        document.getElementById('sifreler-form').addEventListener('submit', (e) => handleChangePassword(e));
        document.getElementById('sifreler-form-edit').addEventListener('submit', (e) => handleChangePassword(e));
        document.getElementById('confirmMuqavileBtn').addEventListener('click', async function() { /* ... */ });
        document.getElementById('editMusteriFormu').addEventListener('submit', (e) => { /* ... */ });
        document.getElementById('odenisFormu').addEventListener('submit', (e) => { /* ... */ });
        document.getElementById('confirmBtnYes').addEventListener('click', () => { if (currentConfirmCallback) currentConfirmCallback(); document.getElementById('confirmModal').style.display = 'none'; });
        document.getElementById('confirmBtnNo').addEventListener('click', () => { document.getElementById('confirmModal').style.display = 'none'; });
        
        // ... (digər event listener-lar) ...

        function handleKreditMusteriSearch() {
            const searchTerm = document.getElementById('kreditMusteriAxtarInput').value.toLowerCase().trim();
            const neticelerContainer = document.getElementById('kreditMusteriAxtarNeticeleri');
            const cedvelBody = document.getElementById('kreditMusteriAxtarCedveli');
            cedvelBody.innerHTML = '';
            if (searchTerm.length < 2) { neticelerContainer.style.display = 'none'; return; }
            const tapilanlar = musteriler.filter(m => (getFullName(m).toLowerCase().includes(searchTerm)) || (m.musteriKodu && String(m.musteriKodu).toLowerCase().includes(searchTerm)) || (m.finKod && m.finKod.toLowerCase().includes(searchTerm)) || (Array.isArray(m.nomreler) && m.nomreler.some(n => n && n.includes(searchTerm))));
            if (tapilanlar.length > 0) {
                tapilanlar.forEach(musteri => {
                    const nomrelerStr = Array.isArray(musteri.nomreler) ? musteri.nomreler.join(', ') : '';
                    cedvelBody.innerHTML += `<tr><td>${getFullName(musteri)} <span class="customer-code">${musteri.musteriKodu}</span></td><td>${musteri.finKod || '---'}</td><td>${nomrelerStr}</td><td><button type="button" class="action-btn select-customer-btn" data-id="${musteri.id}">Seç</button></td></tr>`;
                });
            } else {
                cedvelBody.innerHTML = `<tr><td colspan="4" style="text-align:center;">Müştəri tapılmadı.</td></tr>`;
            }
            neticelerContainer.style.display = 'block';
        }

        async function processPayment() {
            // ... (bütün funksiyalar tam şəkildə burada olmalıdır)
        }
        
        // Bütün digər funksiyaları bura daxil etmək lazımdır...
        
        async function initializeApp() {
            document.getElementById('content-area').innerHTML = `<h1><i class="fas fa-spinner fa-spin"></i> Məlumatlar yüklənir...</h1>`;
            const data = await api_call('getAllData');
            if (data) {
                musteriler = data.musteriler || [];
                magazaAdi = data.settings.magazaAdi || 'Mağaza Adı';
                passwords = data.settings.passwords || { delete: "1234", edit: "1234" };
                updateContent('idarə-paneli-sehifesi');
                document.querySelector('.submenu-item[data-content="idarə-paneli-sehifesi"]').classList.add('active');
            } else {
                document.getElementById('content-area').innerHTML = `<h1><i class="fas fa-times-circle"></i> Xəta</h1><p>Məlumatları yükləmək mümkün olmadı.</p>`;
            }
        }

        initializeApp();
    });
    </script>
</body>
</html>
